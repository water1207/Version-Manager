<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ç‰ˆæœ¬æ¯”å¯¹</title>
    <link rel="stylesheet" th:href="@{/main/css/VersionComparision.css}"/>
    <link rel="stylesheet" th:href="@{/layui/css/layui.css}"/>
</head>
<body>
    <div class="top">

        <div class="top1">
            <a class="top1-img" href="/repos_list?uid=1">ğŸŸ</a>
<!--            <img  th:src="@{/main/image/dolphin.png}" alt="">-->
            <a href="/repos_list?uid=1"><h3>è¯­é›€</h3></a>
        </div>

        <div class="top3">
            <a th:href="@{'/doc?did='+${doc.did}}"><b th:text="${doc.name}"></b></a>
            <b>/</b>
            <b>å†å²ç‰ˆæœ¬</b>
            <input type="hidden" th:value="${v1.vid}" id="vid">
            <select>
                <option th:each="v:${vs}" th:text="${v.title}" th:value="${v.vid}"></option>
            </select>

        </div>

        <div class="top2">
            <div class="search-box">
                <input class="search-txt" type="text" name="" placeholder="Type to search">
                <a class="search-btn" href="#">
                    <i class="fa-search"><img th:src="@{/main/image/search.png}" alt=""></i>
                </a>
            </div>
        </div>

        <div class="top4">
            <div class="top4-message">
<!--                <img th:src="@{/main/image/é“ƒé“›.png}" alt="">-->
            </div>
            <div class="top4-img">
<!--                <img th:src="@{/main/image/user.jpg}" alt="">-->
            </div>
        </div>

    </div>

    <div class="container">
        <div class="container1">
            <b class="bb">å†å²ç‰ˆæœ¬</b>
            <div id="version1" style="width: 94%">
                <textarea id="v1" style="display:none;" placeholder="markdown" th:text="${v1.content}"></textarea>
            </div>
        </div>
        <div class="container2">
            <b class="bb">æ¯”å¯¹ç»“æœ</b>
            <div id="compareT" style="width: 94%"  class="markdown-body editormd-html-preview">
                <!-- æ¯”è¾ƒç»“æœ -->
            </div>
        </div>
        <div class="container3">
            <b class="bb">æœ€æ–°ç‰ˆæœ¬</b>
            <div id="version2" style="width: 94%">
                <textarea id="v2" style="display:none;" placeholder="markdown" th:text="${v2.content}"></textarea>
            </div>
        </div>
    </div>
    <div class="compare">
        <button id="diffBtn" class="layui-btn layui-btn-normal">å¯¹æ¯”</button></b>
    </div>
    <input type="hidden" th:value="${did}" id="did">


    <!--ç¼–è¾‘å™¨çš„js-->
    <link rel="stylesheet" th:href="@{/editormd/css/editormd.preview.css}" />
    <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/mark.js/7.0.0/jquery.mark.min.js"></script>
    <script th:src="@{/editormd/lib/marked.min.js}"></script>
    <script th:src="@{/editormd/lib/prettify.min.js}"></script>
    <script th:src="@{/editormd/lib/raphael.min.js}"></script>
    <script th:src="@{/editormd/lib/underscore.min.js}"></script>
    <script th:src="@{/editormd/lib/sequence-diagram.min.js}"></script>
    <script th:src="@{/editormd/lib/flowchart.min.js}"></script>
    <script th:src="@{/editormd/lib/jquery.flowchart.min.js}"></script>
    <script th:src="@{/editormd/js/editormd.min.js}"></script>
    <!--æ–‡æœ¬æ¯”è¾ƒçš„js-->
    <script type="text/javascript" src="js/htmldiff.js"></script>
    <script th:src="@{/layui/layui.js}" charset="utf-8"></script>
    <script type="text/javascript">
        var Editor1;               /* è§£æmdè½¬htmlæ˜¾ç¤º */
        var Editor2;
        $(function () {
            Editor1 = editormd.markdownToHTML("version1", {//æ³¨æ„ï¼šè¿™é‡Œæ˜¯ä¸Šé¢DIVçš„id
                htmlDecode: "style,script,iframe",
                emoji: true,
                taskList: true,
                tocm: true,
                tex: true, // é»˜è®¤ä¸è§£æ
                flowChart: true, // é»˜è®¤ä¸è§£æ
                sequenceDiagram: true, // é»˜è®¤ä¸è§£æ
                codeFold: true
            });
            Editor2 = editormd.markdownToHTML("version2", {//æ³¨æ„ï¼šè¿™é‡Œæ˜¯ä¸Šé¢DIVçš„id
                htmlDecode: "style,script,iframe",
                emoji: true,
                taskList: true,
                tocm: true,
                tex: true, // é»˜è®¤ä¸è§£æ
                flowChart: true, // é»˜è®¤ä¸è§£æ
                sequenceDiagram: true, // é»˜è®¤ä¸è§£æ
                codeFold: true
            });
            var vid = $("#vid").val();
            $("select").val(vid);
        });

        /* å·®å¼‚æ¯”è¾ƒ */
        var diffBtn = document.getElementById("diffBtn");
        var diff = document.getElementById('compareT');
        diffBtn.onclick = function () {
            diff.innerHTML = '<img style="margin-left:48%" src="http://img.t.sinajs.cn/t5/style/images/common/loading.gif">';
            var oldT = document.getElementById('version1').innerHTML;
            var newT = document.getElementById('version2').innerHTML;
            // var oldT = $("#version1").html();
            // var newT = $("#version2").html();
            if(typeof Worker === "undefined"){
                diff.innerHTML = getHTMLDiff(oldT, newT);
            } else{
                var worker = new Worker('js/htmldiff.js');
                worker.postMessage({
                    'newVersion': newT,
                    'oldVersion': oldT
                });
                worker.onmessage = function (evt) {
                    diff.innerHTML = evt.data;
                };
            }
            var vid = $("#vid").val();
            $("select").val(vid);
        };
        $("select").change(function () {
            var vid = $("select").val();
            var did = $("#did").val();
            window.parent.location.href = "http://127.0.0.1:8080/compare?did=" + did + "&vid=" + vid;
        })
        layui.use(['form', 'layedit', 'laydate'], function(){
            var form = layui.form
                ,layer = layui.layer
                ,layedit = layui.layedit
                ,laydate = layui.laydate;

            //æ—¥æœŸ
            laydate.render({
                elem: '#date'
            });
            laydate.render({
                elem: '#date1'
            });

            //åˆ›å»ºä¸€ä¸ªç¼–è¾‘å™¨
            var editIndex = layedit.build('LAY_demo_editor');

            //è‡ªå®šä¹‰éªŒè¯è§„åˆ™
            form.verify({
                title: function(value){
                    if(value.length < 5){
                        return 'æ ‡é¢˜è‡³å°‘å¾—5ä¸ªå­—ç¬¦å•Š';
                    }
                }
                ,pass: [
                    /^[\S]{6,12}$/
                    ,'å¯†ç å¿…é¡»6åˆ°12ä½ï¼Œä¸”ä¸èƒ½å‡ºç°ç©ºæ ¼'
                ]
                ,content: function(value){
                    layedit.sync(editIndex);
                }
            });

            //ç›‘å¬æŒ‡å®šå¼€å…³
            form.on('switch(switchTest)', function(data){
                layer.msg('å¼€å…³checkedï¼š'+ (this.checked ? 'true' : 'false'), {
                    offset: '6px'
                });
                layer.tips('æ¸©é¦¨æç¤ºï¼šè¯·æ³¨æ„å¼€å…³çŠ¶æ€çš„æ–‡å­—å¯ä»¥éšæ„å®šä¹‰ï¼Œè€Œä¸ä»…ä»…æ˜¯ON|OFF', data.othis)
            });

            //ç›‘å¬æäº¤
            form.on('submit(demo1)', function(data){
                layer.alert(JSON.stringify(data.field), {
                    title: 'æœ€ç»ˆçš„æäº¤ä¿¡æ¯'
                })
                return false;
            });

            //è¡¨å•èµ‹å€¼
            layui.$('#LAY-component-form-setval').on('click', function(){
                form.val('example', {
                    "username": "è´¤å¿ƒ" // "name": "value"
                    ,"password": "123456"
                    ,"interest": 1
                    ,"like[write]": true //å¤é€‰æ¡†é€‰ä¸­çŠ¶æ€
                    ,"close": true //å¼€å…³çŠ¶æ€
                    ,"sex": "å¥³"
                    ,"desc": "æˆ‘çˆ± layui"
                });
            });

            //è¡¨å•å–å€¼
            layui.$('#LAY-component-form-getval').on('click', function(){
                var data = form.val('example');
                alert(JSON.stringify(data));
            });

        });
    </script>
</body>
</html>